<UserControl x:Class="All_New_Jongbet.DashboardPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:lvc="clr-namespace:LiveCharts.Wpf;assembly=LiveCharts.Wpf"
             mc:Ignorable="d" 
             d:DesignHeight="700" d:DesignWidth="1000"
             Background="Transparent">
    <UserControl.Resources>
        <Style TargetType="lvc:DefaultTooltip" x:Key="LiveChartsTooltip">
            <Setter Property="Background" Value="{StaticResource PrimaryBackground}"/>
            <Setter Property="BorderBrush" Value="{StaticResource BorderColor}"/>
            <Setter Property="Foreground" Value="{StaticResource PrimaryText}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="4"/>
            <Setter Property="Padding" Value="10, 8"/>
            <Setter Property="FontSize" Value="12"/>
        </Style>

        <DataTemplate x:Key="ChartTooltipTemplate">
            <StackPanel MinWidth="120">
                <TextBlock Text="{Binding Point.DataContext.Date, StringFormat='yyyy-MM-dd'}" FontWeight="Bold" Foreground="{StaticResource PrimaryText}"/>
                <Separator Margin="0,4" Background="{StaticResource BorderColor}"/>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition/>
                        <RowDefinition/>
                    </Grid.RowDefinitions>
                    <TextBlock Grid.Row="0" Grid.Column="0" Text="자산" Foreground="{StaticResource SecondaryText}" Margin="0,0,10,0"/>
                    <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding Point.DataContext.EstimatedAsset, StringFormat=N0}" FontWeight="SemiBold" HorizontalAlignment="Right"/>
                    <TextBlock Grid.Row="1" Grid.Column="0" Text="수익률" Foreground="{StaticResource SecondaryText}" Margin="0,0,10,0"/>
                    <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding Point.DataContext.ProfitRate, StringFormat={}{0:P2}}" FontWeight="SemiBold" HorizontalAlignment="Right"/>
                </Grid>
            </StackPanel>
        </DataTemplate>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Grid Grid.Row="0" Margin="30,25,30,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition/>
                <ColumnDefinition/>
                <ColumnDefinition/>
                <ColumnDefinition/>
            </Grid.ColumnDefinitions>

            <Border Grid.Column="0" Style="{StaticResource KPICard}" Margin="10" Padding="20">
                <StackPanel>
                    <TextBlock Text="TOTAL ASSETS" Style="{StaticResource CardTitle}"/>
                    <TextBlock Text="{Binding TotalAssetText}" Style="{StaticResource CardValue}"/>
                </StackPanel>
            </Border>
            <Border Grid.Column="1" Style="{StaticResource KPICard}" Margin="10" Padding="20">
                <StackPanel>
                    <TextBlock Text="TOTAL P/L" Style="{StaticResource CardTitle}"/>
                    <TextBlock Text="{Binding TotalProfitLossText}" Style="{StaticResource CardValue}" Foreground="{Binding ProfitLossColor}"/>
                </StackPanel>
            </Border>
            <Border Grid.Column="2" Style="{StaticResource KPICard}" Margin="10" Padding="20">
                <StackPanel>
                    <TextBlock Text="DAILY CHANGE" Style="{StaticResource CardTitle}"/>
                    <TextBlock Text="{Binding DailyChangeText}" Style="{StaticResource CardValue}" Foreground="{Binding DailyChangeColor}"/>
                </StackPanel>
            </Border>
            <Border Grid.Column="3" Style="{StaticResource KPICard}" Margin="10" Padding="20">
                <StackPanel>
                    <TextBlock Text="DAILY CHANGE (%)" Style="{StaticResource CardTitle}"/>
                    <TextBlock Text="{Binding DailyChangeRateText}" Style="{StaticResource CardValue}" Foreground="{Binding DailyChangeColor}"/>
                </StackPanel>
            </Border>
        </Grid>

        <Grid Grid.Row="1" Margin="30,10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="1*"/>
            </Grid.ColumnDefinitions>

            <Border Grid.Column="0" Style="{StaticResource KPICard}" Margin="10">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <Grid Grid.Row="0">
                        <TextBlock Text="Asset Trend" Style="{StaticResource CardTitle}" FontSize="16" Foreground="{StaticResource PrimaryText}" VerticalAlignment="Center"/>
                        <Border Background="{StaticResource PrimaryBackground}" CornerRadius="6" Padding="2" HorizontalAlignment="Right">
                            <StackPanel Orientation="Horizontal">
                                <ToggleButton x:Name="Btn1m" Content="1m" Style="{StaticResource PeriodButtonStyle}" IsChecked="True" Click="PeriodButton_Click"/>
                                <ToggleButton x:Name="Btn3m" Content="3m" Style="{StaticResource PeriodButtonStyle}" Click="PeriodButton_Click"/>
                                <ToggleButton x:Name="Btn6m" Content="6m" Style="{StaticResource PeriodButtonStyle}" Click="PeriodButton_Click"/>
                            </StackPanel>
                        </Border>
                    </Grid>

                    <!-- [FIXED] x:Name 속성 추가 -->
                    <lvc:CartesianChart x:Name="AssetTrendChart" Grid.Row="1" Series="{Binding SeriesCollection}" LegendLocation="None" Height="220" Margin="0,15,0,-10">
                        <lvc:CartesianChart.DataTooltip>
                            <lvc:DefaultTooltip Style="{StaticResource LiveChartsTooltip}" BulletSize="10" ContentTemplate="{StaticResource ChartTooltipTemplate}"/>
                        </lvc:CartesianChart.DataTooltip>
                        <lvc:CartesianChart.AxisX>
                            <lvc:Axis Labels="{Binding Labels}" Foreground="{StaticResource SecondaryText}" ShowLabels="True">
                                <lvc:Axis.Separator>
                                    <lvc:Separator StrokeThickness="0" />
                                </lvc:Axis.Separator>
                            </lvc:Axis>
                        </lvc:CartesianChart.AxisX>
                        <lvc:CartesianChart.AxisY>
                            <lvc:Axis Title="Assets" LabelFormatter="{Binding YFormatter}" Foreground="{StaticResource SecondaryText}">
                                <lvc:Axis.Separator>
                                    <lvc:Separator Stroke="{StaticResource BorderColor}" StrokeThickness="1" StrokeDashArray="2"/>
                                </lvc:Axis.Separator>
                            </lvc:Axis>
                            <lvc:Axis Title="Profit(%)" Position="RightTop" ShowLabels="False" Foreground="{StaticResource SecondaryText}">
                                <lvc:Axis.Separator>
                                    <lvc:Separator StrokeThickness="0"/>
                                </lvc:Axis.Separator>
                            </lvc:Axis>
                        </lvc:CartesianChart.AxisY>
                    </lvc:CartesianChart>
                </Grid>
            </Border>

            <Border Grid.Column="1" Style="{StaticResource KPICard}" Margin="10">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <Grid Grid.Row="0">
                        <TextBlock Text="Today's Orders" Style="{StaticResource CardTitle}" FontSize="16" Foreground="{StaticResource PrimaryText}" VerticalAlignment="Center"/>
                        <Border Background="{StaticResource BorderColor}" CornerRadius="10" Padding="8,3" HorizontalAlignment="Right">
                            <TextBlock Text="{Binding OrderQueList.Count}" FontWeight="Bold" Foreground="{StaticResource PrimaryText}"/>
                        </Border>
                    </Grid>

                    <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Margin="0,15,0,0" Height="220">
                        <ItemsControl ItemsSource="{Binding OrderQueList}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Margin="0,0,0,8" CornerRadius="4" Background="{StaticResource SecondaryBackground}" BorderThickness="3,0,0,0" BorderBrush="{Binding CardBrushKey, Converter={StaticResource ResourceKeyToBrushConverter}}">
                                        <Grid Margin="12,8">
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                            </Grid.RowDefinitions>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Row="0" Grid.Column="0" Text="{Binding StockName}" FontWeight="Bold" Foreground="{StaticResource PrimaryText}"/>
                                            <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding OrderStatusDisplay}" FontWeight="SemiBold" HorizontalAlignment="Right" Foreground="{Binding CardBrushKey, Converter={StaticResource ResourceKeyToBrushConverter}}"/>
                                            <StackPanel Grid.Row="1" Grid.Column="0" Orientation="Horizontal" Margin="0,4,0,0">
                                                <TextBlock Text="{Binding OrderTypeDisplay}" Foreground="{StaticResource SecondaryText}" FontSize="11"/>
                                                <TextBlock Text=" | " Foreground="{StaticResource BorderColor}" FontSize="11" Margin="5,0"/>
                                                <TextBlock Text="{Binding OrderQuantity, StringFormat={}{0}주}" Foreground="{StaticResource SecondaryText}" FontSize="11"/>
                                                <TextBlock Text=" @ " Foreground="{StaticResource BorderColor}" FontSize="11" Margin="5,0"/>
                                                <TextBlock Text="{Binding OrderPrice, StringFormat=N0}" Foreground="{StaticResource SecondaryText}" FontSize="11"/>
                                            </StackPanel>
                                            <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding OrderTime}" FontSize="11" Foreground="{StaticResource SecondaryText}" HorizontalAlignment="Right" Margin="0,4,0,0"/>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                </Grid>
            </Border>
        </Grid>

        <Border Grid.Row="2" Style="{StaticResource KPICard}" Margin="40,0,40,20">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <TextBlock Grid.Row="0" Text="Account Status" Style="{StaticResource CardTitle}" FontSize="16" Foreground="{StaticResource PrimaryText}"/>

                <ScrollViewer Grid.Row="1" HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Disabled">
                    <ItemsControl ItemsSource="{Binding AccountStatuses}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Button Style="{StaticResource PlainButton}" Click="AccountChart_Click" Margin="20,10">
                                    <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                                        <Grid Width="121" Height="121">
                                            <lvc:PieChart Series="{Binding PieChartSeries}"
                                                          InnerRadius="50"
                                                          LegendLocation="None"
                                                          Hoverable="False">
                                                <lvc:PieChart.ChartLegend>
                                                    <lvc:DefaultLegend Visibility="Collapsed"/>
                                                </lvc:PieChart.ChartLegend>
                                                <lvc:PieChart.DataTooltip>
                                                    <lvc:DefaultTooltip Visibility="Collapsed"/>
                                                </lvc:PieChart.DataTooltip>
                                            </lvc:PieChart>

                                            <StackPanel VerticalAlignment="Center">
                                                <TextBlock Text="{Binding DailyProfitRate, StringFormat={}{0:P2}}" 
                                                           FontSize="14" FontWeight="Bold" HorizontalAlignment="Center"
                                                           Foreground="{Binding DailyProfitLossColor}"
                                                           Margin="0,0,0,5"/>

                                                <TextBlock Text="{Binding DailyProfitLoss, StringFormat=N0}" 
                                                           FontSize="14" FontWeight="Bold" HorizontalAlignment="Center"
                                                           Foreground="{Binding DailyProfitLossColor}"/>
                                            </StackPanel>
                                        </Grid>

                                        <TextBlock Text="{Binding AccountNumber}" 
                                                   FontSize="14" FontWeight="SemiBold" 
                                                   HorizontalAlignment="Center" Margin="0,15,0,0"
                                                   Foreground="{StaticResource SecondaryText}"/>
                                    </StackPanel>
                                </Button>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </Grid>
        </Border>
    </Grid>
</UserControl>
